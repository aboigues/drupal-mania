<?php

/**
 * @file
 * Module principal pour Drupal Mania
 */

use Drupal\Core\Routing\RouteMatchInterface;

/**
 * Implements hook_help().
 */
function drupalmania_module_help($route_name, RouteMatchInterface $route_match) {
  switch ($route_name) {
    case 'help.page.drupalmania_module':
      $output = '<h3>' . t('About') . '</h3>';
      $output .= '<p>' . t('Module personnalisé pour Drupal Mania.') . '</p>';
      $output .= '<h3>' . t('Uses') . '</h3>';
      $output .= '<dl>';
      $output .= '<dt>' . t('Custom functionality') . '</dt>';
      $output .= '<dd>' . t('Fournit des fonctionnalités personnalisées pour le site.') . '</dd>';
      $output .= '</dl>';
      return $output;
  }
}

/**
 * Implements hook_theme().
 */
function drupalmania_module_theme($existing, $type, $theme, $path) {
  return [
    'drupalmania_custom_block' => [
      'variables' => [
        'title' => NULL,
        'content' => NULL,
      ],
    ],
  ];
}

/**
 * Implements hook_page_attachments().
 */
function drupalmania_module_page_attachments(array &$attachments) {
  // Ajouter une bibliothèque CSS/JS à toutes les pages
  $attachments['#attached']['library'][] = 'drupalmania_module/drupalmania-library';
}

/**
 * Implements hook_preprocess_HOOK() for node templates.
 */
function drupalmania_module_preprocess_node(&$variables) {
  // Ajouter des variables personnalisées aux nodes
  $node = $variables['node'];

  // Exemple: ajouter un compteur de vues (nécessite un champ custom)
  if ($node->hasField('field_views_count')) {
    $variables['views_count'] = $node->get('field_views_count')->value;
  }
}

/**
 * Implements hook_form_alter().
 */
function drupalmania_module_form_alter(&$form, \Drupal\Core\Form\FormStateInterface $form_state, $form_id) {
  // Exemple: modifier le formulaire de commentaire
  if ($form_id == 'comment_comment_form') {
    $form['subject']['widget'][0]['value']['#placeholder'] = t('Enter your comment title...');
  }
}

/**
 * Implements hook_entity_presave().
 */
function drupalmania_module_entity_presave(Drupal\Core\Entity\EntityInterface $entity) {
  // Exemple: actions avant la sauvegarde d'une entité
  if ($entity->getEntityTypeId() == 'node') {
    // Logique personnalisée
  }
}

/**
 * Implements hook_cron().
 */
function drupalmania_module_cron() {
  // Tâches planifiées
  \Drupal::logger('drupalmania_module')->notice('Cron exécuté à @time', [
    '@time' => date('Y-m-d H:i:s'),
  ]);
}
